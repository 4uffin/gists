<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Contributions Art</title>
    <link rel="icon" type="image/x-icon" href="https://duffin.neocities.org/images/gharticon.png">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and overall aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Deeper dark background, similar to GitHub */
            color: #c9d1d9; /* Lighter text for contrast */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem; /* Increased padding */
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition for theme change */
        }
        .container {
            background-color: #161b22; /* Slightly lighter dark background for container, GitHub-like card */
            border: 1px solid #30363d; /* Subtle border */
            border-radius: 0.75rem; /* Slightly less rounded */
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3); /* Softer shadow for dark mode container */
            padding: 2.5rem; /* Increased padding */
            width: 100%;
            max-width: 700px; /* Adjusted max width */
            text-align: center;
            position: relative; /* Added for absolute positioning of theme toggle */
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; /* Smooth transition */
        }
        input[type="text"] {
            background-color: #0d1117; /* Darker input background, matching body */
            color: #c9d1d9; /* Light text */
            border: 1px solid #30363d; /* Subtle border */
            border-radius: 0.375rem; /* Slightly less rounded */
            padding: 0.3rem 0.8rem; /* Further reduced padding for shorter height */
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.3s ease, color 0.3s ease;
            font-size: 0.95rem; /* Slightly smaller font size for compactness */
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #58a6ff; /* GitHub blue on focus */
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3); /* Blue glow on focus */
        }
        /* Adjusted placeholder color for better contrast */
        input[type="text"]::placeholder {
            color: #8b949e; /* Lighter placeholder text for better contrast */
            transition: color 0.3s ease;
        }
        /* Base button style for both View and Save */
        .github-button {
            background-color: #238636; /* GitHub green button */
            color: white;
            padding: 0.3rem 1rem; /* Further reduced padding to match input height */
            border-radius: 0.375rem; /* Slightly less rounded */
            font-weight: 600; /* Semi-bold */
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, color 0.3s ease;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* More subtle shadow */
            font-size: 0.95rem; /* Slightly smaller font size for compactness */
        }
        .github-button:hover {
            background-color: #2ea043; /* Darker green on hover */
            transform: translateY(-2px); /* Slight lift on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover */
        }

        #graph-container {
            margin-top: 2.5rem; /* Increased margin */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 180px; /* Increased minimum height */
            background-color: #010409; /* Darker background for graph area for better contrast */
            border: 1px solid #30363d; /* Border for graph area */
            border-radius: 0.5rem;
            padding: 1rem; /* Padding inside graph container */
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; /* Added box-shadow transition */
        }
        #graph-container img {
            max-width: 100%; /* Ensure image is responsive */
            height: auto;
            border-radius: 0.375rem; /* Rounded corners for image */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); /* Subtle shadow for image */
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #58a6ff; /* GitHub blue spinner */
            border-radius: 50%;
            width: 45px; /* Slightly larger spinner */
            height: 45px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: #f85149; /* GitHub red for error messages */
            font-weight: bold;
            margin-top: 1.5rem;
            transition: color 0.3s ease;
        }
        /* Adjusted initial message color for better contrast */
        .initial-message {
            color: #c9d1d9; /* Lighter text for initial message for better contrast */
            transition: color 0.3s ease;
        }
        /* Specific style for the save button to ensure consistent margin */
        #saveGraphBtn {
            margin-top: 1.5rem; /* Space above the button */
        }
        .explanation-text {
            margin-top: 2rem; /* Space above the text */
            font-size: 0.9rem; /* Slightly smaller font size */
            color: #8b949e; /* Grayish text color */
            line-height: 1.5;
            transition: color 0.3s ease;
        }
        .privacy-note {
            margin-top: 1rem; /* Space above the privacy note */
            font-size: 0.8rem; /* Even smaller font size for a note */
            color: #c9d1d9; /* Brighter color for the note */
            transition: color 0.3s ease;
        }

        /* --- Light Mode Styles --- */
        body.light-mode {
            background-color: #ffffff; /* White background */
            color: #24292e; /* Dark text */
        }
        body.light-mode .container {
            background-color: #f6f8fa; /* Light background for container */
            border-color: #d1d5da; /* Lighter border */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer shadow for light mode container */
        }
        body.light-mode h1 { /* Fix for title readability */
            color: #24292e; /* Dark text for title in light mode */
        }
        body.light-mode input[type="text"] {
            background-color: #ffffff;
            color: #24292e;
            border-color: #d1d5da;
        }
        body.light-mode input[type="text"]:focus {
            outline: none;
            border-color: #0366d6;
            box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3);
        }
        body.light-mode input[type="text"]::placeholder {
            color: #6a737d;
        }
        body.light-mode .github-button {
            background-color: #2ea44f; /* GitHub green button */
            color: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); /* Softer shadow for buttons in light mode */
        }
        body.light-mode .github-button:hover {
            background-color: #2c974b;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15); /* Slightly more pronounced on hover */
        }
        body.light-mode #graph-container {
            background-color: #ffffff; /* White background for graph container */
            border-color: #d1d5da;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* Lighter shadow to blend in */
        }
        body.light-mode .loading-spinner {
            border-top-color: #0366d6; /* GitHub blue spinner */
        }
        body.light-mode .error-message {
            color: #cb2431; /* GitHub red for error messages */
        }
        body.light-mode .initial-message,
        body.light-mode .explanation-text,
        body.light-mode .privacy-note {
            color: #586069; /* Darker text for light mode */
        }

        /* Style for the theme toggle button in dark mode (default) */
        #themeToggle {
            background-color: #21262d; /* Darker background to blend with container */
            color: #c9d1d9; /* Lighter icon color for contrast */
            border: 1px solid #30363d; /* Border to match container */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15); /* Softer shadow for dark mode toggle */
            font-size: 1.5rem; /* Larger font size for emojis */
            line-height: 1; /* Adjust line height for vertical centering */
        }
        #themeToggle:hover {
            background-color: #2e353e; /* Slightly lighter on hover */
            transform: translateY(-1px); /* Less dramatic lift */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25); /* Slightly more pronounced on hover */
        }

        /* Style for the theme toggle button in light mode */
        body.light-mode #themeToggle {
            background-color: #eef1f4; /* Slightly lighter background for toggle button to blend */
            color: #586069; /* Darker icon color to blend */
            border: 1px solid #c8ccd1; /* Lighter border to blend */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* Softer shadow */
        }
        body.light-mode #themeToggle:hover {
            background-color: #e0e3e7; /* Even lighter on hover */
            transform: translateY(-1px); /* Less dramatic lift */
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08); /* Slightly more pronounced on hover */
        }

        /* Emoji visibility based on mode */
        .emoji-icon {
            display: none; /* Hide all emojis by default */
        }
        #sunEmoji.active {
            display: inline-block; /* Show sun emoji when active */
        }
        #moonEmoji.active {
            display: inline-block; /* Show moon emoji when active */
        }

        /* Styles for the GitHub Image Button */
        #githubImageBtn img {
            transition: transform 0.3s ease, opacity 0.3s ease; /* Smooth transition for hover effects */
        }

        #githubImageBtn:hover img {
            transform: scale(1.1); /* Enlarge slightly on hover */
            opacity: 0.7; /* Reduce opacity for a more noticeable effect */
        }
    </style>
</head>
<body>
    <main class="container">
        <!-- Dark/Light Mode Toggle Button -->
        <button id="themeToggle" class="github-button absolute top-4 right-4 p-2 rounded-full flex items-center justify-center" aria-label="Toggle dark/light mode">
            <!-- Sun Emoji (for light mode) -->
            <span id="sunEmoji" class="emoji-icon">☀️</span>
            <!-- Moon Emoji (for dark mode) -->
            <span id="moonEmoji" class="emoji-icon">🌙</span>
        </button>

        <h1 class="text-3xl font-bold mb-8 text-white">GitHub Contributions Art</h1>

        <!-- GitHub Image Button -->
        <button id="githubImageBtn" class="mb-8 p-0 border-none bg-transparent cursor-pointer" aria-label="Visit GitHub Projects Space Repository">
            <img src="https://duffin.neocities.org/images/github_PNG80.png" alt="GitHub Logo" class="w-20 h-auto mx-auto">
        </button>

        <div class="flex flex-col sm:flex-row sm:items-stretch justify-center gap-5 mb-8">
            <input
                type="text"
                id="usernameInput"
                placeholder="Enter GitHub username"
                class="flex-grow"
                aria-label="GitHub username"
            />
            <button id="viewGraphBtn" class="github-button">View Graph</button>
        </div>

        <!-- Added aria-live="polite" for screen reader announcements of dynamic content -->
        <div id="graph-container" aria-live="polite">
            <p class="initial-message">Enter a GitHub username and click "View Graph" to see their contributions.</p>
        </div>

        <!-- New Save Image Button -->
        <button id="saveGraphBtn" class="github-button hidden">Save Image</button>

        <!-- New Explanation Text -->
        <p class="explanation-text">
            I built this because I'm a big fan of the GitHub contributions graph. I find it really satisfying how consistent activity can generate cool and interesting patterns.
        </p>

        <!-- New Privacy Note -->
        <p class="privacy-note">
            Note: This tool respects privacy. Certain usernames are excluded from display via an array in the code. Fork the <a href="https://github.com/4uffin/projectsspace">repository</a> to add yours.
        </p>
    </main>

    <script>
        // Get references to DOM elements
        const usernameInput = document.getElementById('usernameInput');
        const viewGraphBtn = document.getElementById('viewGraphBtn');
        const graphContainer = document.getElementById('graph-container');
        const saveGraphBtn = document.getElementById('saveGraphBtn'); // Reference to the new save button
        const themeToggle = document.getElementById('themeToggle'); // Reference to the new theme toggle button
        const sunEmoji = document.getElementById('sunEmoji'); // Reference to the sun emoji
        const moonEmoji = document.getElementById('moonEmoji'); // Reference to the moon emoji
        const githubImageBtn = document.getElementById('githubImageBtn'); // Reference to the new GitHub image button

        // Array of usernames that should not be displayed
        // You can add or remove usernames from this list.
        const excludedUsernames = [
            'privateuser1', // Example excluded username
            'another_private_account', // Another example
            'connor', // Adding Connor's username as an example for exclusion
            'testuser'
        ];

        /**
         * Sets the current theme (dark or light) and saves it to localStorage.
         * Updates the body class and the visibility of the sun/moon emojis.
         * @param {string} theme - The theme to set ('dark' or 'light').
         */
        function setTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.remove('light-mode');
                sunEmoji.classList.remove('active'); // Hide sun emoji
                moonEmoji.classList.add('active');    // Show moon emoji
            } else {
                document.body.classList.add('light-mode');
                sunEmoji.classList.add('active');     // Show sun emoji
                moonEmoji.classList.remove('active'); // Hide moon emoji
            }
            localStorage.setItem('theme', theme); // Save preference
        }

        // Load saved theme on page load
        // Default to 'dark' if no theme preference is found in localStorage
        const savedTheme = localStorage.getItem('theme') || 'dark';
        setTheme(savedTheme);

        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark') {
                setTheme('light');
            } else {
                setTheme('dark');
            }
        });

        /**
         * Fetches and displays the GitHub contribution graph for the given username.
         * This version uses an external service (ghchart.rshah.org) to generate the image.
         * @param {string} username - The GitHub username.
         */
        function displayContributionGraph(username) {
            // Clear previous content and show loading spinner
            graphContainer.innerHTML = '<div class="loading-spinner"></div>';
            saveGraphBtn.classList.add('hidden'); // Hide save button while loading

            if (!username) {
                graphContainer.innerHTML = '<p class="error-message">Please enter a GitHub username.</p>';
                return;
            }

            // Check if the username is in the excluded list
            if (excludedUsernames.includes(username.toLowerCase())) { // Convert to lowercase for case-insensitive check
                graphContainer.innerHTML = `<p class="error-message">The contributions graph for "${username}" cannot be displayed due to privacy settings or exclusion rules.</p>`;
                saveGraphBtn.classList.add('hidden'); // Ensure save button is hidden
                return; // Stop execution
            }

            // Construct the URL for the contribution graph using ghchart.rshah.org
            // This service provides an SVG image of the contribution graph.
            const graphUrl = `https://ghchart.rshah.org/${username}`;

            // Create a new Image object to check if the image loads successfully
            const img = new Image();
            img.src = graphUrl;
            img.alt = `GitHub Contribution Graph for ${username}`; // Alt text for accessibility
            img.className = 'w-full h-auto'; // Tailwind classes for responsive image

            img.onload = () => {
                // If the image loads successfully, replace the loading spinner with the image
                graphContainer.innerHTML = '';
                graphContainer.appendChild(img);
                saveGraphBtn.classList.remove('hidden'); // Show save button after graph loads
            };

            img.onerror = () => {
                // If there's an error loading the image (e.g., invalid username, network issue)
                graphContainer.innerHTML = `<p class="error-message">Could not load graph for "${username}". Please check the username or try again later.</p>`;
                saveGraphBtn.classList.add('hidden'); // Ensure save button is hidden on error
            };
        }

        /**
         * Handles saving the displayed contribution graph image.
         */
        function saveContributionGraph() {
            const graphImage = graphContainer.querySelector('img');
            if (graphImage && graphImage.src) {
                const imageUrl = graphImage.src;
                const username = usernameInput.value.trim();
                // Change filename extension to .svg as ghchart.rshah.org returns SVG
                const filename = `github_contributions_${username || 'graph'}.svg`; // Dynamic filename with .svg extension

                // Create a temporary anchor element
                const a = document.createElement('a');
                a.href = imageUrl;
                a.download = filename; // Set the download filename
                document.body.appendChild(a); // Append to body to make it clickable
                a.click(); // Programmatically click the anchor to trigger download
                document.body.removeChild(a); // Clean up the temporary anchor
            } else {
                // No graph image to save, no action needed or console warning
                console.warn("No graph image found to save."); // Add a console warning for debugging
            }
        }

        // Add event listener to the view graph button
        viewGraphBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            displayContributionGraph(username);
        });

        // Add event listener to the new save graph button
        saveGraphBtn.addEventListener('click', saveContributionGraph);

        // Add event listener to the GitHub image button to open GitHub
        githubImageBtn.addEventListener('click', () => {
            window.open('https://github.com/4uffin/projectsspace', '_blank'); // Open GitHub in a new tab
        });

        // Optional: Allow pressing Enter key in the input field to trigger the search
        usernameInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                const username = usernameInput.value.trim();
                displayContributionGraph(username);
            }
        });

        // Example: Load my own GitHub contributions on page load
        // displayContributionGraph('connor'); // You can uncomment this to pre-load a graph
    </script>
</body>
</html>