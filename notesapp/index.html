<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Old School Notebook Notes</title>
    <link rel="icon" type="image/x-icon" href="https://duffin.neocities.org/images/notesappfavicon.png">
    <style>
        /* Skip link styling for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #000;
            color: #ffeb3b;
            padding: 8px;
            z-index: 100;
            text-decoration: none;
            transition: top 0.3s ease-in-out;
            /* Smooth transition for skip link */
        }

        .skip-link:focus {
            top: 0;
        }

        /* Basic reset and overall layout */
        body {
            display: flex;
            margin: 0;
            font-family: "Courier New", Courier, monospace;
            height: 100vh;
            background-color: #fffde7;
            /* Light yellow paper background */
            color: #000;
            overflow: hidden;
            /* Prevent body scroll, allow content to scroll */
        }

        /* Sidebar styling with yellow background and black accents */
        .sidebar {
            width: 250px;
            /* Fixed width for desktop */
            background-color: #ffeb3b;
            /* Bright yellow for sidebar */
            padding: 10px;
            border-right: 2px solid #000;
            overflow-y: auto;
            /* Allow scrolling for notes list */
            flex-shrink: 0;
            /* Prevent sidebar from shrinking */
        }

        /* Mark the sidebar as a region with an accessible name (visually hidden) */
        .sidebar[role="region"]::before {
            content: "Notes Sidebar";
            position: absolute;
            left: -9999px;
            /* Hide text off-screen */
        }

        .sidebar h2 {
            margin-top: 0;
            text-align: center;
            border-bottom: 1px solid #000;
            padding-bottom: 5px;
        }

        #add-note {
            width: 100%;
            padding: 10px;
            /* Increased padding for better touch target */
            margin-bottom: 10px;
            background-color: #000;
            color: #ffeb3b;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
            /* Slightly rounded corners */
            transition: opacity 0.2s ease-in-out;
            /* Smooth hover effect */
        }

        .note-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: #e0e000;
            /* Slightly darker yellow for note items */
            border: 1px solid #000;
            cursor: pointer;
            border-radius: 3px;
            /* Slightly rounded corners */
            transition: background-color 0.2s ease-in-out;
            /* Smooth transition for active state */
        }

        .note-item.active {
            background-color: #ffffff;
            /* White background for active note */
            border-left: 5px solid #000;
            /* Highlight active note */
            padding-left: 5px;
            /* Adjust padding due to border */
        }

        .note-item:hover {
            background-color: #ffffcc;
            /* Lighter yellow on hover */
        }

        /* Editor styling with a lined paper feel */
        .editor {
            flex: 1;
            /* Editor takes remaining space */
            padding: 10px 25px 10px 10px;
            /* Added spacing on the right side, adjusted overall padding */
            background-color: #fffde7;
            display: flex;
            flex-direction: column;
            border-left: 2px solid #000;
            overflow-y: auto;
            /* Allow scrolling for long notes */
        }

        .editor label {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .editor input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #000;
            /* Slightly thinner border */
            font-family: "Courier New", Courier, monospace;
            box-sizing: border-box;
            /* Include padding and border in the element's total width and height */
            border-radius: 5px;
        }

        .editor textarea {
            flex: 1;
            /* Textarea takes available vertical space */
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #000;
            /* Slightly thinner border */
            resize: vertical;
            /* Allow vertical resizing only */
            background-color: #fff;
            color: #000;
            line-height: 1.5;
            /* Create the lined paper effect */
            background-image: linear-gradient(#000 1px, transparent 1px);
            background-size: 100% 24px;
            /* Line height */
            background-position: 0 10px;
            /* Offset for the first line */
            box-sizing: border-box;
            border-radius: 5px;
        }

        .editor .button-group {
            margin-top: 15px;
            /* Increased margin */
            display: flex;
            /* Arrange buttons in a row */
            flex-wrap: wrap;
            /* Allow buttons to wrap on smaller screens */
            gap: 10px;
            /* Space between buttons */
        }

        .editor button {
            padding: 10px 15px;
            /* Increased padding for better touch target */
            font-size: 16px;
            background-color: #000;
            color: #ffeb3b;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
            transition: opacity 0.2s ease-in-out;
            flex-grow: 1;
            /* Allow buttons to grow and fill space */
            min-width: 120px;
            /* Minimum width for buttons */
        }

        .editor button:hover,
        #add-note:hover {
            opacity: 0.8;
        }

        /* Error message styling */
        #error-message {
            color: red;
            font-weight: bold;
            margin-top: 15px;
            /* Increased margin */
            text-align: center;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
                /* Stack sidebar and editor vertically */
                height: auto;
                /* Allow body to grow based on content */
                min-height: 100vh;
                /* Ensure it takes at least full viewport height */
            }

            .sidebar {
                width: 100%;
                /* Sidebar takes full width */
                border-right: none;
                border-bottom: 2px solid #000;
                /* Add border to the bottom */
                max-height: 40vh;
                /* Limit sidebar height on small screens */
            }

            .editor {
                width: 100%;
                /* Editor takes full width */
                border-left: none;
                margin-right: 0;
                /* Remove right margin */
                padding: 10px;
                /* Adjust padding */
            }

            .editor .button-group {
                flex-direction: column;
                /* Stack buttons vertically */
            }

            .editor button {
                width: 100%;
                /* Buttons take full width */
                margin-right: 0;
                /* Remove right margin */
            }
        }

        /* Custom Confirmation Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease-in-out;
        }

        .modal-overlay.visible {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: #ffeb3b;
            border: 2px solid #000;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            width: 90%;
            font-family: "Courier New", Courier, monospace;
        }

        .modal-content p {
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.2s ease-in-out;
        }

        .modal-buttons button.confirm-btn {
            background-color: #000;
            color: #ffeb3b;
        }

        .modal-buttons button.cancel-btn {
            background-color: #e0e000;
            color: #000;
            border: 1px solid #000;
        }

        .modal-buttons button:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <a href="#main-content" class="skip-link">Skip to content</a>
    <div class="sidebar" role="region" aria-label="Notes Sidebar">
        <h2>Notes</h2>
        <button id="add-note">Add Note</button>
        <div id="notes-list" role="list"></div>
    </div>
    <div class="editor" id="main-content" role="main">
        <label for="note-title">Title:</label>
        <input type="text" id="note-title" placeholder="Enter note title..." />
        <label for="note-content">Note:</label>
        <textarea id="note-content" placeholder="Select a note or add a new one..."></textarea>
        <div class="button-group">
            <button id="save-note">Save Note</button>
            <button id="delete-note">Delete Note</button>
            <button id="toggle-pin">Pin Note</button>
        </div>
        <div id="error-message" role="alert" aria-live="assertive"></div>
    </div>

    <!-- Custom Confirmation Modal HTML -->
    <div id="confirmation-modal" class="modal-overlay" role="dialog" aria-modal="true"
        aria-labelledby="modal-title">
        <div class="modal-content">
            <p id="modal-title">Are you sure you want to delete this note?</p>
            <div class="modal-buttons">
                <button class="confirm-btn" id="modal-confirm-btn">Yes, Delete</button>
                <button class="cancel-btn" id="modal-cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Array to store notes and variable to track the active note
        let notes = [];
        let activeNoteId = null;

        /**
         * Displays an error message temporarily.
         * @param {string} message - The error message to display.
         */
        function displayError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            if (message) {
                // Clear the error message after 5 seconds
                setTimeout(() => {
                    errorDiv.textContent = '';
                }, 5000);
            }
        }

        /**
         * Loads notes from localStorage.
         */
        function loadNotes() {
            try {
                const notesJSON = localStorage.getItem('notes');
                if (notesJSON) {
                    notes = JSON.parse(notesJSON);
                } else {
                    notes = [];
                }
            } catch (error) {
                console.error("Error loading notes:", error);
                notes = []; // Reset notes if loading fails
                displayError("Failed to load notes. Data might be corrupted.");
            }
        }

        /**
         * Saves notes to localStorage.
         */
        function saveNotes() {
            try {
                localStorage.setItem('notes', JSON.stringify(notes));
            } catch (error) {
                console.error("Error saving notes:", error);
                displayError("Failed to save notes. Local storage might be full.");
            }
        }

        /**
         * Renders the list of notes in the sidebar, sorting pinned notes first.
         */
        function renderNotesList() {
            try {
                const notesList = document.getElementById('notes-list');
                notesList.innerHTML = ''; // Clear existing list

                // Sort notes: pinned notes first, then by ID (creation time)
                const sortedNotes = notes.slice().sort((a, b) => {
                    if (a.pinned === b.pinned) {
                        return a.id - b.id; // Maintain creation order for unpinned/pinned
                    }
                    return a.pinned ? -1 : 1; // Pinned notes come before unpinned
                });

                sortedNotes.forEach(note => {
                    const noteItem = document.createElement('div');
                    noteItem.className = 'note-item';
                    noteItem.setAttribute('role', 'listitem');
                    noteItem.setAttribute('tabindex', '0'); // Make div focusable for keyboard navigation

                    if (note.id === activeNoteId) {
                        noteItem.classList.add('active');
                    }

                    // Add a pin icon if the note is pinned
                    noteItem.textContent = (note.pinned ? "📌 " : "") + (note.title || 'New Note');

                    // Event listener for clicking a note item
                    noteItem.addEventListener('click', () => {
                        selectNote(note.id);
                    });

                    // Event listener for keyboard navigation (Enter key)
                    noteItem.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') { // Allow Enter and Space to select
                            e.preventDefault(); // Prevent default scroll behavior for Space
                            selectNote(note.id);
                        }
                    });

                    notesList.appendChild(noteItem);
                });
            } catch (error) {
                console.error("Error rendering notes list:", error);
                displayError("Failed to render notes list.");
            }
        }

        /**
         * Selects a note and displays its content in the editor.
         * @param {number} noteId - The ID of the note to select.
         */
        function selectNote(noteId) {
            activeNoteId = noteId;
            const note = notes.find(n => n.id === activeNoteId);
            if (note) {
                document.getElementById('note-title').value = note.title;
                document.getElementById('note-content').value = note.content;
                updateTogglePinButton();
                renderNotesList(); // Re-render to update active state
            }
        }

        /**
         * Updates the Pin/Unpin button text based on the current note's pinned state.
         */
        function updateTogglePinButton() {
            const toggleButton = document.getElementById('toggle-pin');
            const note = notes.find(n => n.id === activeNoteId);
            if (note && note.pinned) {
                toggleButton.textContent = "Unpin Note";
            } else {
                toggleButton.textContent = "Pin Note";
            }
            // Disable pin button if no note is active
            toggleButton.disabled = activeNoteId === null;
        }

        /**
         * Adds a new note to the list.
         */
        function addNote() {
            try {
                const newNote = {
                    id: Date.now(), // Unique ID based on timestamp
                    title: '',
                    content: '',
                    pinned: false
                };
                notes.push(newNote);
                selectNote(newNote.id); // Select the newly added note
                saveNotes();
            } catch (error) {
                console.error("Error adding note:", error);
                displayError("Failed to add note.");
            }
        }

        /**
         * Saves the current note's title and content.
         */
        function saveCurrentNote() {
            try {
                if (activeNoteId === null) {
                    displayError("No note selected to save.");
                    return;
                }
                const noteTitle = document.getElementById('note-title').value;
                const noteContent = document.getElementById('note-content').value;
                const note = notes.find(n => n.id === activeNoteId);
                if (note) {
                    note.title = noteTitle;
                    note.content = noteContent;
                    saveNotes();
                    renderNotesList(); // Re-render to update title in list
                } else {
                    displayError("Active note not found. Cannot save.");
                }
            } catch (error) {
                console.error("Error saving current note:", error);
                displayError("Failed to save note.");
            }
        }

        /**
         * Toggles the pinned status for the current note.
         */
        function togglePinCurrentNote() {
            try {
                if (activeNoteId === null) {
                    displayError("No note selected to pin/unpin.");
                    return;
                }
                const note = notes.find(n => n.id === activeNoteId);
                if (note) {
                    note.pinned = !note.pinned;
                    saveNotes();
                    updateTogglePinButton();
                    renderNotesList(); // Re-render to update pin icon and sort order
                } else {
                    displayError("Active note not found. Cannot toggle pin.");
                }
            } catch (error) {
                console.error("Error toggling pin:", error);
                displayError("Failed to update pin status.");
            }
        }

        /**
         * Deletes the current active note.
         */
        function deleteCurrentNote() {
            try {
                if (activeNoteId === null) {
                    displayError("No note selected to delete.");
                    return;
                }

                // Show custom confirmation modal instead of browser's confirm()
                showConfirmationModal("Are you sure you want to delete this note?",
                    // On confirm
                    () => {
                        notes = notes.filter(note => note.id !== activeNoteId);
                        activeNoteId = null; // Deselect the note
                        document.getElementById('note-title').value = '';
                        document.getElementById('note-content').value = '';
                        updateTogglePinButton(); // Update button state
                        saveNotes();
                        renderNotesList(); // Re-render the list
                    },
                    // On cancel (do nothing)
                    () => {
                        // User cancelled, do nothing
                    }
                );

            } catch (error) {
                console.error("Error deleting note:", error);
                displayError("Failed to delete note.");
            }
        }

        /**
         * Shows a custom confirmation modal.
         * @param {string} message - The message to display in the modal.
         * @param {function} onConfirm - Callback function to execute if confirmed.
         * @param {function} onCancel - Callback function to execute if cancelled.
         */
        function showConfirmationModal(message, onConfirm, onCancel) {
            const modalOverlay = document.getElementById('confirmation-modal');
            const modalTitle = document.getElementById('modal-title');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            modalTitle.textContent = message;
            modalOverlay.classList.add('visible'); // Make modal visible

            // Remove previous listeners to prevent multiple calls
            confirmBtn.onclick = null;
            cancelBtn.onclick = null;

            // Add new listeners
            confirmBtn.onclick = () => {
                modalOverlay.classList.remove('visible');
                onConfirm();
            };
            cancelBtn.onclick = () => {
                modalOverlay.classList.remove('visible');
                onCancel();
            };

            // Focus on the confirm button for accessibility
            confirmBtn.focus();
        }


        // Event listeners for buttons
        document.getElementById('add-note').addEventListener('click', addNote);
        document.getElementById('save-note').addEventListener('click', saveCurrentNote);
        document.getElementById('delete-note').addEventListener('click', deleteCurrentNote);
        document.getElementById('toggle-pin').addEventListener('click', togglePinCurrentNote);

        // Save note when "Enter" is pressed in the title input
        document.getElementById('note-title').addEventListener('keydown', function(e) {
            if (e.key === "Enter") {
                e.preventDefault(); // Prevent new line in input field
                saveCurrentNote();
                // Optionally, move focus to content area after saving
                document.getElementById('note-content').focus();
            }
        });

        // Save note content on blur (when focus leaves the textarea)
        document.getElementById('note-content').addEventListener('blur', saveCurrentNote);

        // Initialize the app on page load
        window.onload = function() {
            try {
                loadNotes();
                renderNotesList();
                updateTogglePinButton(); // Initial state for pin button
            } catch (error) {
                console.error("Initialization error:", error);
                displayError("An error occurred during initialization.");
            }
        };
    </script>
</body>

</html>